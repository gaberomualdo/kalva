---
layout: default
title: "Your Feed"
stylesheet: "index"
---
<script>

function addArticle(newsArticle){
  var image = "";
  var has_image_style = "";
  var no_image_class = "";
  if(!newsArticle.description){
    newsArticle.description = "";
  }
  if(newsArticle.urlToImage){
    has_image_style = "display: none;";
    image = "<img src='" + newsArticle.urlToImage + "' onload='this.parentElement.removeAttribute(\"style\");' onerror='this.parentElement.classList.add(\"no_image\");this.parentElement.removeAttribute(\"style\");this.outerHTML=\"\";'>";
  }else{
    no_image_class = "no_image";
  }
  document.querySelector("div.site_container ul.articles").innerHTML += `
  <a onclick="openArticle('${newsArticle.url}')" target="_blank" class="${no_image_class}" style='${has_image_style}'>
    ${image}
    <div class='content'>
      <h1>${newsArticle.title}</h1>
      <p>${newsArticle.description}</p>
      <p class='meta'>By <strong>${newsArticle.source.name}</strong> on ${formatDate(new Date(newsArticle.publishedAt))}</p>
    </div>
  </a>
  `;
}
function openArticle(url){
  window.open(url, "_blank");
}
function requestAPI(url, func){
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      func(this.responseText);
    }
  };
  xhttp.open("GET", url, true);
  xhttp.send();
}

function updateSourceArticles(){
  document.querySelector("div.misc_area div.select_box select").blur();
  var source = document.querySelector("div.misc_area div.select_box select").value;
  document.querySelector("ul.articles").innerHTML = "";
  requestAPI("https://newsapi.org/v2/top-headlines?sources=" + source + "&apiKey=377facbb80c140388ec9cdb16a7f7ee0", function(response){
    JSON.parse(response).articles.forEach(function(newsArticle, newsIndex){
      addArticle(newsArticle);
    });
  });
}

(function(){
  const possibleTabs = ["top","source","topic"];
  if(possibleTabs.indexOf(getQueryVariable("p")) == -1){
    window.open("?p=top","_self");
  }
  window.onload = function(){
    document.querySelector("ul.sections a:nth-child(" + (possibleTabs.indexOf(getQueryVariable("p")) + 1) + ")").classList.add("active");
  }
  if(possibleTabs.indexOf(getQueryVariable("p")) == 0){
    requestAPI("https://newsapi.org/v2/top-headlines?country=us&apiKey=377facbb80c140388ec9cdb16a7f7ee0", function(response){
      JSON.parse(response).articles.forEach(function(newsArticle, newsIndex){
        addArticle(newsArticle);
      });
    });
  }else if(possibleTabs.indexOf(getQueryVariable("p")) == 1){
    requestAPI("https://newsapi.org/v2/sources?language=en&apiKey=377facbb80c140388ec9cdb16a7f7ee0", function(response){
      var selectOptions = "";
      JSON.parse(response).sources.forEach(function(source){
        selectOptions += "<option value='" + source.id + "'>" + source.name + "</option>";
      });
      document.querySelector("div.misc_area").innerHTML += `
      <div class="select_box">
        <p>Source: </p>
        <select onchange='updateSourceArticles();'>
          ${selectOptions}
        </select>
      </div>
      `;
      updateSourceArticles();
    });
  }else if(possibleTabs.indexOf(getQueryVariable("p")) == 2){

  }
})();

</script>

<ul class="sections">
  <a href="?p=top">Top News</a>
  <a href="?p=source">News By Source</a>
  <a href="?p=topic">News By Topic</a>
</ul>

<div class="misc_area">

</div>

<ul class="articles">

</ul>
